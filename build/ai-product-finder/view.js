document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll(".wp-block-ai-product-finder-search").forEach(function(e){const t=e.querySelector(".ai-search-input"),n=e.querySelector(".search-button");function r(){const r=t.value.trim();if(r){const o=parseInt(e.dataset.resultCount)||3;n.disabled=!0,n.textContent="...",t.disabled=!0,t.value="Searching for: "+r,t.style.color="#999";const c=e.querySelector(".search-results");c.innerHTML='<div class="loading-container"><div class="loading-dots"><span></span><span></span><span></span></div></div>',c.classList.add("show"),fetch("/wp-json/ai-product-finder/v1/search",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:r,count:o})}).then(e=>e.json()).then(t=>{t.success&&t.results?function(e,t,n){const r=e.querySelector(".search-results");r.innerHTML="",t.forEach(function(e){const t=function(e,t){const n=document.getElementById("product-card-template");if(!n)return console.error("Product card template not found"),null;const r=n.content.cloneNode(!0),o=e.wc_data||e.metadata,c=r.querySelector(".product-image");o.image_url?(c.src=o.image_url,c.alt=o.name||"Product image"):c.style.display="none";const s=r.querySelector(".product-name");o.name?s.textContent=o.name:s.textContent="Product";const a=r.querySelector(".product-price");o.price_html?a.innerHTML=o.price_html:o.price&&(a.textContent=o.price);r.querySelector(".product-explanation").textContent=t||"Great match for your search.";const d=r.querySelector(".product-card");return o.product_url&&d.addEventListener("click",function(){window.open(o.product_url,"_blank")}),r}(e,n[e.id]||"");t&&r.appendChild(t)}),r.classList.add("show")}(e,t.results,t.explanations):function(e){const t=e.querySelector(".search-results");t.innerHTML='<div class="no-results">No products found. Try a different search term.</div>',t.classList.add("show")}(e)}).catch(t=>{console.error("API Error:",t),function(e){const t=e.querySelector(".search-results"),n=document.createElement("div");n.className="error-message",n.textContent="Search failed. Please try again.",t.innerHTML="",t.appendChild(n),t.classList.add("show")}(e)}).finally(()=>{n.disabled=!1,n.textContent="üîç",t.disabled=!1,t.value=r,t.style.color=""})}}e.querySelectorAll(".suggestion-chip").forEach(function(e){e.addEventListener("click",function(){const n=e.textContent;t.value=n,t.focus()})}),t.addEventListener("keydown",function(e){"Enter"===e.key&&r()}),n.addEventListener("click",function(){r()})})});