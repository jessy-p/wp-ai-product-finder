document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll(".wp-block-create-block-ai-style-finder").forEach(function(e){const t=e.querySelector(".ai-search-input"),n=e.querySelector(".search-button");function o(){const o=t.value.trim();o&&(n.disabled=!0,n.textContent="...",t.disabled=!0,t.value="Searching...",t.style.color="#999",console.log("Calling API for:",o),fetch("/wp-json/ai-style-finder/v1/search",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:o})}).then(e=>e.json()).then(t=>{console.log("API Response:",t),t.success&&t.results?function(e,t,n){const o=e.querySelector(".search-results");o.innerHTML="",t.forEach(function(e){const t=function(e,t){const n=document.getElementById("product-card-template");if(!n)return console.error("Product card template not found"),null;const o=n.content.cloneNode(!0),r=e.wc_data||e.metadata,c=o.querySelector(".product-image");r.image_url?(c.src=r.image_url,c.alt=r.name||"Product image"):c.style.display="none";const s=o.querySelector(".product-name");r.name?s.innerHTML=r.name:s.textContent="Product";const a=o.querySelector(".product-price");r.price_html?a.innerHTML=r.price_html:r.price&&(a.textContent=r.price);const l=o.querySelector(".product-explanation");t?l.innerHTML=t:l.textContent="Great match for your search.";const i=o.querySelector(".product-card");return r.product_url&&i.addEventListener("click",function(){window.open(r.product_url,"_blank")}),o}(e,n[e.id]||"");t&&o.appendChild(t)}),o.classList.add("show")}(e,t.results,t.explanations):function(e){const t=e.querySelector(".search-results");t.innerHTML='<div class="no-results">No products found. Try a different search term.</div>',t.classList.add("show")}(e)}).catch(t=>{console.error("API Error:",t),function(e){const t=e.querySelector(".search-results");t.innerHTML='<div class="error-message">Search failed. Please try again.</div>',t.classList.add("show")}(e)}).finally(()=>{n.disabled=!1,n.textContent="üîç",t.disabled=!1,t.value=o,t.style.color=""}))}e.querySelectorAll(".suggestion-chip").forEach(function(e){e.addEventListener("click",function(){const n=e.textContent;t.value=n,t.focus()})}),t.addEventListener("keydown",function(e){"Enter"===e.key&&o()}),n.addEventListener("click",function(){o()})})});